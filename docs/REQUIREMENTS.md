# 📋 교환권 시스템 상세 요구사항

## 🎯 프로젝트 개요

### 목표
교환권 발행·조회·사용처리를 전산화하고, A4 단건 PDF와 모바일 링크/QR로 제시·검증 가능하게 만들기

### 핵심 가치
- **중복 사용 방지**: 원자적 사용처리로 중복 사용 차단
- **현장 스캔 속도**: QR 스캔 후 3초 이내 사용처리
- **간편한 정산**: A4 PDF로 정산 및 감사 추적
- **감사 추적**: 모든 작업에 대한 상세 로그

## 🔐 인증 시스템 요구사항

### 로그인 방식
- **문자 인증만 사용**: 이메일/비밀번호 방식 제외
- **휴대폰 번호**: 사용자 식별자로 사용
- **인증번호**: 6자리 숫자, 5분 유효

### 회원가입 프로세스
1. **관리자 등록**: admin 권한을 가진 사용자가 신규 사용자 등록
2. **사용자 정보**: 이름, 휴대폰 번호, 사업장, 역할
3. **휴대폰 인증**: 등록된 휴대폰으로 인증번호 발송
4. **계정 활성화**: 인증 완료 후 계정 사용 가능

### 권한 관리
- **admin**: 모든 기능 접근 가능, 사용자 관리, 데이터 관리
- **staff**: 스캔, 검증, 사용처리만 가능

## 📱 디바이스별 UI 요구사항

### 모바일 (스캔 전용)
- **메인 메뉴**: 스캔, 내 교환권, 로그아웃
- **스캔 기능**: 카메라 스캔 + 수동 입력
- **교환권 정보**: 간단한 정보 표시
- **사용처리**: 즉시 사용처리 가능

### PC (관리자 메뉴 포함)
- **모든 모바일 기능**
- **데이터베이스 관리**:
  - 사용자 관리 (등록, 수정, 삭제)
  - 교환권 관리 (발행, 조회, 취소)
  - 사업장 관리
  - 통계 및 리포트
- **감사 로그**: 모든 작업 내역 조회

## 💬 SMS 서비스 요구사항

### 개발 단계 (Mock SMS)
- **콘솔 출력**: 개발 환경에서 인증번호 콘솔에 표시
- **테스트 용이**: 실제 SMS 발송 없이 기능 테스트
- **비용 없음**: 개발/테스트 단계에서 SMS 비용 절약

### 운영 단계 (네이버 클라우드 SENS)
- **실제 발송**: 실제 휴대폰으로 인증번호 발송
- **비용**: 22원/건 (대량 할인 가능)
- **안정성**: 국내 최대 클라우드 서비스
- **모니터링**: 발송 성공/실패 로그

## 🗄️ 데이터베이스 요구사항

### 기존 테이블
- `sites`: 사업장 정보
- `users`: 사용자 정보 (역할, 사업장)
- `vouchers`: 교환권 정보
- `audit_logs`: 감사 로그

### 추가 필요 테이블
- `sms_verifications`: SMS 인증 정보
- `user_registrations`: 사용자 등록 요청
- `phone_verifications`: 휴대폰 인증 내역

### RLS 정책
- **사업장별 접근**: 사용자는 자신의 사업장 데이터만 접근
- **역할별 권한**: admin은 모든 데이터, staff는 제한적 접근
- **감사 로그**: 모든 데이터 변경 사항 기록

## 🔒 보안 요구사항

### 인증 보안
- **세션 관리**: JWT 토큰 기반 인증
- **인증번호 유효성**: 5분 제한, 재시도 제한
- **계정 잠금**: 잘못된 인증 시도 시 일시적 잠금

### 데이터 보안
- **암호화**: 민감한 데이터 암호화 저장
- **접근 제어**: RLS로 데이터베이스 레벨 보안
- **감사 추적**: 모든 데이터 접근 및 변경 로그

## 📊 성능 요구사항

### 응답 시간
- **스캔 → 검증**: 1초 이내
- **검증 → 사용처리**: 2초 이내
- **PDF 생성**: 3초 이내
- **전체 프로세스**: 5초 이내

### 동시 사용자
- **최소**: 10명 동시 사용
- **목표**: 100명 동시 사용
- **확장성**: 1000명 동시 사용 준비

## 🧪 테스트 요구사항

### 단위 테스트
- **API 엔드포인트**: 모든 API 함수 테스트
- **비즈니스 로직**: 교환권 검증, 사용처리 로직
- **데이터베이스**: RLS 정책, 트랜잭션

### 통합 테스트
- **인증 플로우**: SMS 인증 전체 과정
- **교환권 프로세스**: 발행 → 제시 → 사용처리
- **권한 제어**: 역할별 접근 권한

### 사용자 테스트
- **모바일 사용성**: 실제 모바일 기기에서 테스트
- **PC 관리자**: 관리자 기능 사용성 테스트
- **네트워크 환경**: 약전파 환경에서의 안정성

## 📈 모니터링 요구사항

### 로그 수집
- **애플리케이션 로그**: 에러, 경고, 정보 로그
- **사용자 행동**: 페이지 접근, 기능 사용 통계
- **성능 지표**: 응답 시간, 처리량

### 알림 시스템
- **에러 알림**: 심각한 오류 발생 시 즉시 알림
- **성능 알림**: 응답 시간 지연 시 알림
- **사용량 알림**: SMS 발송량, 데이터베이스 사용량

## 🚀 배포 요구사항

### 환경 설정
- **개발 환경**: Mock SMS, 테스트 데이터
- **스테이징 환경**: 실제 SMS, 운영 데이터 구조
- **운영 환경**: 실제 SMS, 운영 데이터

### 배포 프로세스
- **자동화**: CI/CD 파이프라인으로 자동 배포
- **롤백**: 문제 발생 시 이전 버전으로 빠른 복구
- **데이터 마이그레이션**: 스키마 변경 시 안전한 데이터 이전

## 📝 문서화 요구사항

### 사용자 매뉴얼
- **관리자 매뉴얼**: 시스템 관리, 사용자 관리
- **사용자 매뉴얼**: 스캔, 교환권 사용 방법
- **운영 매뉴얼**: 일상 운영, 문제 해결

### 개발자 문서
- **API 문서**: 모든 엔드포인트 설명
- **데이터베이스 스키마**: 테이블 구조, 관계
- **배포 가이드**: 환경 설정, 배포 방법
