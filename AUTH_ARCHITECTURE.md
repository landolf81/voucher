# ğŸ” ì¸ì¦ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## í˜„ì¬ êµ¬ì¡° (Custom Auth)

### âœ… **ì‚¬ìš© ì¤‘ì¸ í…Œì´ë¸”**
- `public.users` - ì‚¬ìš©ì ì •ë³´ (user_id, phone, role ë“±)
- `sites` - ì‚¬ì—…ì¥ ì •ë³´

### âŒ **ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥**
- `auth.users` (Supabase Authentication)
- Supabase Auth API
- OAuth ë¡œê·¸ì¸

## ì¸ì¦ í”Œë¡œìš°

```mermaid
graph TD
    A[ì‚¬ìš©ì ID ì…ë ¥] --> B[public.users ì¡°íšŒ]
    B --> C{ì‚¬ìš©ì ì¡´ì¬?}
    C -->|Yes| D[SMS ë°œì†¡]
    C -->|No| E[ì˜¤ë¥˜: ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ìš©ì]
    D --> F[ì¸ì¦ë²ˆí˜¸ ì…ë ¥]
    F --> G[SMS ê²€ì¦]
    G --> H{ì¸ì¦ ì„±ê³µ?}
    H -->|Yes| I[JWT í† í° ìƒì„±]
    H -->|No| J[ì˜¤ë¥˜: ì¸ì¦ ì‹¤íŒ¨]
    I --> K[ë¡œê·¸ì¸ ì™„ë£Œ]
```

## í…Œì´ë¸” êµ¬ì¡°

### public.users
| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| id | uuid | Primary Key |
| user_id | text | ë¡œê·¸ì¸ ID (admin, staff ë“±) |
| phone | text | ì „í™”ë²ˆí˜¸ (SMS ì¸ì¦ìš©) |
| name | text | ì‚¬ìš©ì ì´ë¦„ |
| role | text | ê¶Œí•œ (admin/staff) |
| site_id | uuid | ì†Œì† ì‚¬ì—…ì¥ |

### ì´ˆê¸° ë°ì´í„°
```sql
-- ê´€ë¦¬ì
admin / 01087654321 / admin

-- ì§ì›  
staff / 01023456789 / staff

-- ì¡°íšŒìš©
viewer / 01012345678 / staff
```

## ë³´ì•ˆ íŠ¹ì§•

### âœ… **ì¥ì **
- ì „í™”ë²ˆí˜¸ ê¸°ë°˜ ì¸ì¦ (í•œêµ­ í™˜ê²½ì— ì í•©)
- ë‹¨ìˆœí•œ êµ¬ì¡°
- SMS 2FA ë‚´ì¥
- ì‚¬ì—…ì¥ë³„ ê¶Œí•œ ê´€ë¦¬

### âš ï¸ **ì£¼ì˜ì‚¬í•­**
- JWT Secret ë³´ì•ˆ ê´€ë¦¬ í•„ìš”
- SMS ë°œì†¡ ë¹„ìš© ê³ ë ¤
- ì „í™”ë²ˆí˜¸ ë³€ê²½ ì‹œ ì—…ë°ì´íŠ¸ í•„ìš”

## ì„¤ì • ë°©ë²•

### 1. í…Œì´ë¸” ìƒì„±
```sql
\i '/supabase/schema.sql'
```

### 2. ì´ˆê¸° ë°ì´í„°
```sql  
\i '/supabase/seed_users.sql'
```

### 3. í™˜ê²½ ë³€ìˆ˜
```bash
# JWT í† í°ìš©
JWT_SECRET=your-secret-key

# HMAC QR ì„œëª…ìš©  
VOUCHER_HMAC_SECRET=your-hmac-key
```

## FAQ

**Q: Supabase Authentication ì‚¬ìš©í•´ì•¼ í•˜ë‚˜ìš”?**
A: ì•„ë‹ˆìš”. í˜„ì¬ Custom Authë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤.

**Q: auth.users í…Œì´ë¸”ì´ ë¹„ì–´ìˆì–´ë„ ë˜ë‚˜ìš”?**
A: ë„¤. public.usersë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

**Q: OAuth ë¡œê·¸ì¸ ì¶”ê°€í•  ìˆ˜ ìˆë‚˜ìš”?**
A: ê°€ëŠ¥í•˜ì§€ë§Œ í˜„ì¬ SMS ì¸ì¦ì´ ë” ì í•©í•©ë‹ˆë‹¤.